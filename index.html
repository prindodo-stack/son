<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전라남도교육청창의융합교육원 - 행사 및 급식 관리</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8fafc; overflow-x: hidden; }
        .chart-bar { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .no-meal-day { background: repeating-linear-gradient(45deg, #f1f5f9, #f1f5f9 10px, #e2e8f0 10px, #e2e8f0 20px); opacity: 0.6; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .glass-panel { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // 아이콘 컴포넌트
        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                dashboard: <path d="M3 3h7v9H3zm11 0h7v5h-7zm0 9h7v9h-7zm-11 11h7v-7H3z"/>,
                plus: <path d="M12 5v14M5 12h14"/>,
                list: <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/>,
                users: <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2M9 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm14 14v-2a4 4 0 0 0-3-3.87M18 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"/>,
                utensils: <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20M21 15V2a5 5 0 0 0-5 5v8c0 1.1.9 2 2 2h3c0 1.1.9 2 2 2v3"/>,
                trash: <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>,
                refresh: <path d="M21 2v6h-6M3 12a9 9 0 0 1 15-6.7L21 8M3 22v-6h6M21 12a9 9 0 0 1-15 6.7L3 16"/>,
                chevronLeft: <path d="M15 18l-6-6 6-6"/>,
                chevronRight: <path d="M9 18l6-6-6-6"/>,
                settings: <React.Fragment><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></React.Fragment>,
                calendarX: <React.Fragment><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/><line x1="10" y1="14" x2="14" y2="18"/><line x1="14" y1="14" x2="10" y2="18"/></React.Fragment>,
                alert: <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4m0 4h.01" />
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name]}
                </svg>
            );
        };

        const SUPABASE_URL = 'https://zyuybhszykxuafzriksn.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_3h3_2LRYgdyeXdoDO6XZMA_4jQrQTtV'; 
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const WEEKDAYS = ["일", "월", "화", "수", "목", "금", "토"];

        function App() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [events, setEvents] = useState([]);
            const [loading, setLoading] = useState(false);
            const [viewMode, setViewMode] = useState('week');
            const [viewDate, setViewDate] = useState(new Date());
            
            // 정원 및 기본 인원 설정
            const [baseSettings, setBaseSettings] = useState(() => {
                const saved = localStorage.getItem('jucie_settings_v4');
                return saved ? JSON.parse(saved) : { 
                    maxCapacity: 220, 
                    baseMealCount: 45,
                    operatingDays: [false, true, true, true, true, true, false], 
                    excludedDates: [] 
                };
            });

            const [formData, setFormData] = useState({
                event_date: new Date().toISOString().split('T')[0],
                department: '기획부',
                event_name: '',
                total_participants: 0,
                meal_participants: 0
            });

            useEffect(() => {
                localStorage.setItem('jucie_settings_v4', JSON.stringify(baseSettings));
            }, [baseSettings]);

            const fetchEvents = async () => {
                setLoading(true);
                try {
                    const { data, error } = await supabaseClient
                        .from('events')
                        .select('*')
                        .order('event_date', { ascending: true });
                    if (error) throw error;
                    setEvents(data || []);
                } catch (error) {
                    console.error("Fetch Error:", error);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => { fetchEvents(); }, []);

            const navigateDate = (direction) => {
                const nextDate = new Date(viewDate);
                if (viewMode === 'day') {
                    nextDate.setDate(viewDate.getDate() + direction);
                } else if (viewMode === 'week') {
                    nextDate.setDate(viewDate.getDate() + (direction * 7));
                } else if (viewMode === 'month') {
                    nextDate.setMonth(viewDate.getMonth() + direction);
                }
                setViewDate(nextDate);
            };

            // 필터링 및 계산 로직 (기본 45 + 방문 급식 합계)
            const filteredData = useMemo(() => {
                const start = new Date(viewDate);
                const end = new Date(viewDate);

                if (viewMode === 'day') {
                    start.setHours(0, 0, 0, 0); end.setHours(23, 59, 59, 999);
                } else if (viewMode === 'week') {
                    const day = start.getDay();
                    start.setDate(start.getDate() - day);
                    end.setDate(start.getDate() + 6);
                } else if (viewMode === 'month') {
                    start.setDate(1); end.setMonth(start.getMonth() + 1); end.setDate(0);
                }

                let rangeDays = [];
                const tempDate = new Date(start);
                while (tempDate <= end) {
                    const dateStr = tempDate.toISOString().split('T')[0];
                    const dayIdx = tempDate.getDay();
                    const isOperating = baseSettings.operatingDays[dayIdx] && !baseSettings.excludedDates.includes(dateStr);
                    
                    const dayEvents = events.filter(e => e.event_date === dateStr);
                    const sumVisitors = dayEvents.reduce((s, e) => s + Number(e.total_participants || 0), 0);
                    const sumVisitorMeals = dayEvents.reduce((s, e) => s + Number(e.meal_participants || 0), 0);
                    
                    const totalMeals = isOperating ? (Number(baseSettings.baseMealCount) + sumVisitorMeals) : 0;

                    rangeDays.push({
                        dateStr,
                        dayLabel: WEEKDAYS[dayIdx],
                        shortDate: `${tempDate.getMonth() + 1}/${tempDate.getDate()}`,
                        isOperating,
                        total: sumVisitors,
                        meals: totalMeals,
                        events: dayEvents
                    });
                    tempDate.setDate(tempDate.getDate() + 1);
                }

                const operatingDays = rangeDays.filter(d => d.isOperating);
                const totalMealsInPeriod = rangeDays.reduce((sum, d) => sum + d.meals, 0);
                const avgMeals = operatingDays.length > 0 ? totalMealsInPeriod / operatingDays.length : 0;

                return {
                    items: rangeDays,
                    summary: {
                        total: rangeDays.reduce((sum, d) => sum + d.total, 0),
                        meals: totalMealsInPeriod,
                        avgMeals: avgMeals
                    },
                    periodLabel: viewMode === 'month' 
                        ? `${viewDate.getFullYear()}년 ${viewDate.getMonth() + 1}월`
                        : `${start.toLocaleDateString()} ~ ${end.toLocaleDateString()}`
                };
            }, [events, viewMode, viewDate, baseSettings]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                try {
                    const { error } = await supabaseClient.from('events').insert([formData]);
                    if (error) throw error;
                    setFormData({ event_date: new Date().toISOString().split('T')[0], department: '기획부', event_name: '', total_participants: 0, meal_participants: 0 });
                    fetchEvents();
                    setActiveTab('list');
                } catch (error) { alert(error.message); } finally { setLoading(false); }
            };

            return (
                <div className="min-h-screen flex flex-col md:flex-row text-slate-800">
                    {/* 사이드바 */}
                    <nav className="w-full md:w-72 bg-slate-900 text-white p-6 flex flex-col shrink-0 z-30">
                        <div className="mb-10 flex items-center space-x-3">
                            <div className="bg-blue-600 p-2 rounded-xl shadow-lg"><Icon name="utensils" size={24} /></div>
                            <div>
                                <h1 className="text-xl font-black tracking-tight leading-none text-white">JNCIE CMS</h1>
                                <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-1">행사 및 급식 관리</p>
                            </div>
                        </div>
                        
                        <div className="space-y-1 flex-1">
                            {[
                                { id: 'dashboard', icon: 'dashboard', label: '통계 대시보드' },
                                { id: 'list', icon: 'list', label: '행사 내역 조회' },
                                { id: 'add', icon: 'plus', label: '신규 행사 등록' }
                            ].map(item => (
                                <button key={item.id} onClick={() => setActiveTab(item.id)} 
                                    className={`w-full flex items-center space-x-3 px-4 py-3.5 rounded-xl transition-all ${activeTab === item.id ? 'bg-blue-600 shadow-xl' : 'text-slate-400 hover:bg-slate-800'}`}>
                                    <Icon name={item.icon} size={18} /> <span className="font-bold text-sm">{item.label}</span>
                                </button>
                            ))}
                        </div>

                        {/* 하단 기준 설정 */}
                        <div className="mt-6 p-5 bg-slate-800/40 rounded-2xl border border-slate-700/50 space-y-4">
                            <div className="flex items-center space-x-2 text-slate-500 mb-2">
                                <Icon name="settings" size={14} />
                                <span className="text-[10px] font-black uppercase tracking-tighter">운영 기본값 설정</span>
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <div>
                                    <label className="text-[9px] text-slate-500 font-bold block mb-1 uppercase">식당 정원</label>
                                    <input type="number" value={baseSettings.maxCapacity} onChange={e => setBaseSettings({...baseSettings, maxCapacity: e.target.value})}
                                        className="w-full bg-slate-900 border border-slate-700 rounded-lg px-2 py-1.5 text-xs text-blue-400 font-black focus:border-blue-500 outline-none" />
                                </div>
                                <div>
                                    <label className="text-[9px] text-slate-500 font-bold block mb-1 uppercase">고정 인원</label>
                                    <input type="number" value={baseSettings.baseMealCount} onChange={e => setBaseSettings({...baseSettings, baseMealCount: e.target.value})}
                                        className="w-full bg-slate-900 border border-slate-700 rounded-lg px-2 py-1.5 text-xs text-green-400 font-black focus:border-green-500 outline-none" />
                                </div>
                            </div>
                            <div className="pt-2 border-t border-slate-700/50">
                                <label className="text-[9px] text-slate-500 font-bold block mb-2">디폴트 급식 요일</label>
                                <div className="flex justify-between gap-1">
                                    {WEEKDAYS.map((day, i) => (
                                        <button key={i} onClick={() => {
                                            const newDays = [...baseSettings.operatingDays];
                                            newDays[i] = !newDays[i];
                                            setBaseSettings({...baseSettings, operatingDays: newDays});
                                        }} className={`flex-1 h-7 rounded text-[10px] font-black transition-all ${baseSettings.operatingDays[i] ? 'bg-blue-600 text-white shadow-md shadow-blue-900/40' : 'bg-slate-700 text-slate-500'}`}>
                                            {day}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* 메인 뷰포트 */}
                    <main className="flex-1 p-6 md:p-10 overflow-y-auto bg-[#f8fafc]">
                        {activeTab === 'dashboard' && (
                            <div className="max-w-6xl mx-auto space-y-8 animate-fadeIn">
                                <div className="flex flex-col lg:flex-row lg:items-center justify-between gap-6">
                                    <div>
                                        <h2 className="text-3xl font-black tracking-tight text-slate-900">현황 모니터링</h2>
                                        <p className="text-slate-400 font-medium text-sm mt-1">{filteredData.periodLabel}</p>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <div className="flex bg-white p-1 rounded-2xl shadow-sm border border-slate-200">
                                            {['day', 'week', 'month'].map(mode => (
                                                <button key={mode} onClick={() => setViewMode(mode)}
                                                    className={`px-4 py-2 rounded-xl text-xs font-bold transition-all ${viewMode === mode ? 'bg-slate-900 text-white shadow-lg' : 'text-slate-400 hover:text-slate-600'}`}>
                                                    {mode === 'day' ? '일간' : mode === 'week' ? '주간' : '월간'}
                                                </button>
                                            ))}
                                        </div>
                                        <div className="flex items-center bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                                            <button onClick={() => navigateDate(-1)} className="p-2.5 hover:bg-slate-50 border-r border-slate-100 transition"><Icon name="chevronLeft" size={18}/></button>
                                            <button onClick={() => setViewDate(new Date())} className="px-4 text-[11px] font-black text-slate-500 hover:text-slate-900 transition">TODAY</button>
                                            <button onClick={() => navigateDate(1)} className="p-2.5 hover:bg-slate-50 border-l border-slate-100 transition"><Icon name="chevronRight" size={18}/></button>
                                        </div>
                                    </div>
                                </div>

                                {/* 지표 요약 */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-200 group">
                                        <p className="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-2">총 방문자 (행사 인원)</p>
                                        <div className="flex items-baseline space-x-1">
                                            <h3 className="text-5xl font-black text-slate-900">{filteredData.summary.total.toLocaleString()}</h3>
                                            <span className="text-slate-400 font-bold">명</span>
                                        </div>
                                    </div>
                                    
                                    <div className="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-200 relative overflow-hidden">
                                        <div className="relative z-10">
                                            <p className="text-[11px] font-black text-green-500 uppercase tracking-widest mb-2">실제 급식 예상 인원</p>
                                            <div className="flex items-baseline space-x-1">
                                                <h3 className="text-5xl font-black text-green-600">{filteredData.summary.meals.toLocaleString()}</h3>
                                                <span className="text-slate-400 font-bold">명</span>
                                            </div>
                                            <p className="text-[10px] text-slate-400 mt-3 font-medium flex items-center">
                                                <span className="w-1.5 h-1.5 rounded-full bg-green-500 mr-1.5"></span>
                                                운영일 고정({baseSettings.baseMealCount}) + 방문객 중 급식자 합계
                                            </p>
                                        </div>
                                    </div>

                                    <div className="bg-slate-900 p-8 rounded-[2rem] shadow-2xl text-white relative">
                                        <p className="text-[11px] font-black text-slate-500 uppercase tracking-widest mb-2">식당 수용량 대비 부하율</p>
                                        <div className="flex items-baseline space-x-1">
                                            <h3 className={`text-5xl font-black ${filteredData.summary.avgMeals > baseSettings.maxCapacity ? 'text-red-400' : 'text-blue-400'}`}>
                                                {Math.round(filteredData.summary.avgMeals / baseSettings.maxCapacity * 100) || 0}
                                            </h3>
                                            <span className="text-2xl text-blue-800 font-black">%</span>
                                        </div>
                                        <div className="mt-5 w-full bg-slate-800 rounded-full h-2 overflow-hidden">
                                            <div className={`${filteredData.summary.avgMeals > baseSettings.maxCapacity ? 'bg-red-500' : 'bg-blue-500'} h-full transition-all duration-1000`} style={{ width: `${Math.min(100, filteredData.summary.avgMeals / baseSettings.maxCapacity * 100)}%` }}></div>
                                        </div>
                                    </div>
                                </div>

                                {/* 개선된 메인 차트 (Grouped Bar Chart) */}
                                <div className="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-sm border border-slate-200 relative overflow-hidden">
                                    <div className="flex flex-col md:flex-row md:items-start justify-between mb-16 gap-6">
                                        <div>
                                            <div className="flex items-center space-x-2 mb-1">
                                                <h3 className="text-2xl font-black text-slate-900 tracking-tight">데일리 운영 추이</h3>
                                                <div className="px-2.5 py-1 bg-blue-50 text-blue-600 rounded-full text-[10px] font-bold">인원 비교</div>
                                            </div>
                                            <p className="text-sm text-slate-400 font-medium">그래프를 클릭하여 해당 날짜의 급식 운영 여부를 토글할 수 있습니다.</p>
                                        </div>
                                        <div className="grid grid-cols-2 gap-x-8 gap-y-2 bg-slate-50 p-5 rounded-2xl border border-slate-100">
                                            <div className="flex items-center">
                                                <div className="w-3 h-3 bg-blue-400/40 rounded mr-2"></div>
                                                <span className="text-[11px] font-bold text-slate-500">방문객 총수</span>
                                            </div>
                                            <div className="flex items-center">
                                                <div className="w-3 h-3 bg-green-500 rounded mr-2"></div>
                                                <span className="text-[11px] font-bold text-slate-500">실제 식수</span>
                                            </div>
                                            <div className="flex items-center">
                                                <div className="w-3 h-3 bg-red-500 rounded mr-2"></div>
                                                <span className="text-[11px] font-bold text-slate-500">정원 초과</span>
                                            </div>
                                            <div className="flex items-center">
                                                <div className="w-3 h-3 no-meal-day border border-slate-300 rounded mr-2"></div>
                                                <span className="text-[11px] font-bold text-slate-500">급식 미운영</span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Y축 가이드 라인 (정원 표시) */}
                                    <div className="absolute left-0 right-0 h-[300px] bottom-[115px] pointer-events-none px-8 md:px-12">
                                        <div className="absolute bottom-[100%] left-0 right-0 border-t-2 border-dashed border-red-200/50 z-0">
                                            <span className="absolute -top-3 right-4 bg-white px-2 text-[10px] font-black text-red-400 uppercase">Limit: {baseSettings.maxCapacity}</span>
                                        </div>
                                    </div>

                                    <div className="h-[300px] flex items-end justify-between space-x-1 md:space-x-4 relative z-10">
                                        {filteredData.items.map((item, i) => {
                                            const maxRef = Math.max(...filteredData.items.map(d => Math.max(d.total, d.meals, 1)), baseSettings.maxCapacity * 1.1);
                                            const mealH = (item.meals / maxRef) * 100;
                                            const visitorH = (item.total / maxRef) * 100;
                                            const isOver = item.meals > baseSettings.maxCapacity;

                                            return (
                                                <div key={i} className="flex-1 flex flex-col items-center group h-full relative">
                                                    {/* 상단 툴팁 */}
                                                    {item.isOperating && (
                                                        <div className="absolute -top-14 left-1/2 -translate-x-1/2 bg-slate-900 text-white p-3 rounded-xl opacity-0 group-hover:opacity-100 transition-all duration-300 whitespace-nowrap z-50 pointer-events-none shadow-2xl scale-90 group-hover:scale-100">
                                                            <div className="text-[10px] font-black text-slate-400 mb-1 border-b border-slate-700 pb-1">{item.dateStr}</div>
                                                            <div className="flex flex-col space-y-1">
                                                                <div className="flex justify-between items-center gap-4">
                                                                    <span className="text-[10px] font-bold">총 방문자</span>
                                                                    <span className="text-xs font-black text-blue-400">{item.total}명</span>
                                                                </div>
                                                                <div className="flex justify-between items-center gap-4">
                                                                    <span className="text-[10px] font-bold">예상 식수</span>
                                                                    <span className={`text-xs font-black ${isOver ? 'text-red-400' : 'text-green-400'}`}>{item.meals}명</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    )}

                                                    {/* 막대 컨테이너 */}
                                                    <div onClick={() => {
                                                        const newExcluded = baseSettings.excludedDates.includes(item.dateStr)
                                                            ? baseSettings.excludedDates.filter(d => d !== item.dateStr)
                                                            : [...baseSettings.excludedDates, item.dateStr];
                                                        setBaseSettings({...baseSettings, excludedDates: newExcluded});
                                                    }} className={`flex-1 w-full flex flex-col justify-end items-center rounded-2xl transition-all cursor-pointer relative overflow-hidden p-1 ${!item.isOperating ? 'no-meal-day' : 'hover:bg-slate-50'}`}>
                                                        
                                                        {item.isOperating ? (
                                                            <div className="w-full flex items-end justify-center space-x-1 h-full">
                                                                {/* 방문객 막대 */}
                                                                <div className="w-1/2 bg-blue-400/30 rounded-t-lg chart-bar relative group/bar" style={{ height: `${visitorH}%` }}>
                                                                    <div className="absolute -top-6 left-1/2 -translate-x-1/2 text-[9px] font-black text-slate-400 opacity-0 group-hover/bar:opacity-100">{item.total}</div>
                                                                </div>
                                                                {/* 실제 식수 막대 */}
                                                                <div className={`w-1/2 rounded-t-lg chart-bar shadow-sm relative group/bar ${isOver ? 'bg-red-500 shadow-red-200' : 'bg-green-500 shadow-green-100'}`} style={{ height: `${mealH}%` }}>
                                                                    <div className={`absolute -top-6 left-1/2 -translate-x-1/2 text-[10px] font-black opacity-0 group-hover/bar:opacity-100 ${isOver ? 'text-red-500' : 'text-green-600'}`}>{item.meals}</div>
                                                                    {isOver && <div className="absolute -top-1.5 left-1/2 -translate-x-1/2 text-white"><Icon name="alert" size={10} /></div>}
                                                                </div>
                                                            </div>
                                                        ) : (
                                                            <div className="flex flex-col items-center justify-center h-full text-slate-400">
                                                                <Icon name="calendarX" size={16} />
                                                                <span className="text-[8px] font-black mt-1 uppercase">OFF</span>
                                                            </div>
                                                        )}
                                                    </div>
                                                    
                                                    {/* 라벨 */}
                                                    <div className="mt-5 text-center transition-transform group-hover:scale-110">
                                                        <p className={`text-[11px] font-black ${item.dayLabel === '일' ? 'text-red-500' : item.dayLabel === '토' ? 'text-blue-500' : 'text-slate-500'}`}>{item.dayLabel}</p>
                                                        <p className="text-[9px] font-bold text-slate-300 mt-0.5">{item.shortDate}</p>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'list' && (
                            <div className="max-w-6xl mx-auto space-y-6 animate-fadeIn">
                                <div className="flex items-center justify-between">
                                    <h2 className="text-2xl font-black text-slate-900 tracking-tight">행사 아카이브</h2>
                                    <button onClick={() => setActiveTab('add')} className="bg-slate-900 text-white px-6 py-3 rounded-2xl font-bold text-sm shadow-xl flex items-center space-x-2 hover:scale-[1.02] transition">
                                        <Icon name="plus" size={16}/><span>행사 등록</span>
                                    </button>
                                </div>
                                <div className="bg-white rounded-[2rem] shadow-sm border border-slate-200 overflow-hidden">
                                    <table className="w-full text-left">
                                        <thead className="bg-slate-50 border-b border-slate-100">
                                            <tr>
                                                <th className="px-8 py-5 text-[10px] font-black text-slate-400 uppercase tracking-widest">날짜</th>
                                                <th className="px-8 py-5 text-[10px] font-black text-slate-400 uppercase tracking-widest">부서</th>
                                                <th className="px-8 py-5 text-[10px] font-black text-slate-400 uppercase tracking-widest">행사명</th>
                                                <th className="px-8 py-5 text-[10px] font-black text-slate-400 uppercase tracking-widest text-center">급식 인원</th>
                                                <th className="px-8 py-5 text-[10px] font-black text-slate-400 uppercase tracking-widest text-center">관리</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {events.length === 0 ? (
                                                <tr><td colSpan="5" className="px-8 py-20 text-center text-slate-400 font-bold">등록된 행사 정보가 없습니다.</td></tr>
                                            ) : (
                                                events.slice().reverse().map(event => (
                                                    <tr key={event.id} className="hover:bg-slate-50/50 transition">
                                                        <td className="px-8 py-5 text-sm font-bold text-slate-500">{event.event_date}</td>
                                                        <td className="px-8 py-5"><span className="text-[10px] font-black bg-blue-50 text-blue-600 px-3 py-1 rounded-lg uppercase">{event.department}</span></td>
                                                        <td className="px-8 py-5 text-sm font-black text-slate-800">{event.event_name}</td>
                                                        <td className="px-8 py-5 text-center text-sm font-black text-green-600">{event.meal_participants}명</td>
                                                        <td className="px-8 py-5 text-center">
                                                            <button onClick={async () => {
                                                                if(!confirm("정말 삭제하시겠습니까?")) return;
                                                                await supabaseClient.from('events').delete().match({ id: event.id });
                                                                fetchEvents();
                                                            }} className="text-slate-300 hover:text-red-500 transition-colors p-2"><Icon name="trash" size={18}/></button>
                                                        </td>
                                                    </tr>
                                                ))
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === 'add' && (
                            <div className="max-w-xl mx-auto space-y-8 animate-fadeIn">
                                <div className="text-center">
                                    <h2 className="text-3xl font-black text-slate-900 tracking-tight">행사 정보 입력</h2>
                                    <p className="text-slate-500 font-medium mt-2">방문객 식수 인원만 입력하세요. 기본 {baseSettings.baseMealCount}인에 자동 합산됩니다.</p>
                                </div>
                                <form onSubmit={handleSubmit} className="bg-white p-10 rounded-[2.5rem] shadow-2xl border border-slate-200 space-y-8">
                                    <div className="grid grid-cols-2 gap-6">
                                        <div className="space-y-2">
                                            <label className="text-[11px] font-black text-slate-400 uppercase tracking-widest">행사 일정</label>
                                            <input type="date" required className="w-full p-4 bg-slate-50 border-none rounded-2xl font-bold focus:ring-2 focus:ring-blue-500 outline-none transition" 
                                                value={formData.event_date} onChange={e => setFormData({...formData, event_date: e.target.value})} />
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-[11px] font-black text-slate-400 uppercase tracking-widest">담당 부서</label>
                                            <select className="w-full p-4 bg-slate-50 border-none rounded-2xl font-bold focus:ring-2 focus:ring-blue-500 outline-none appearance-none cursor-pointer"
                                                value={formData.department} onChange={e => setFormData({...formData, department: e.target.value})}>
                                                {["기획부", "창의부", "정보부", "총무부"].map(d => <option key={d} value={d}>{d}</option>)}
                                            </select>
                                        </div>
                                    </div>
                                    <div className="space-y-2">
                                        <label className="text-[11px] font-black text-slate-400 uppercase tracking-widest">행사 명칭</label>
                                        <input type="text" required placeholder="예: 과학 영재 캠프" className="w-full p-4 bg-slate-50 border-none rounded-2xl font-bold focus:ring-2 focus:ring-blue-500 outline-none transition" 
                                            value={formData.event_name} onChange={e => setFormData({...formData, event_name: e.target.value})} />
                                    </div>
                                    <div className="grid grid-cols-2 gap-6">
                                        <div className="space-y-2">
                                            <label className="text-[11px] font-black text-slate-400 uppercase tracking-widest">총 참석자</label>
                                            <input type="number" className="w-full p-4 bg-slate-50 border-none rounded-2xl font-black text-xl outline-none focus:ring-2 focus:ring-blue-500 transition" 
                                                value={formData.total_participants} onChange={e => setFormData({...formData, total_participants: e.target.value})} />
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-[11px] font-black text-green-500 uppercase tracking-widest">방문 급식 인원</label>
                                            <input type="number" className="w-full p-4 bg-slate-50 border-none rounded-2xl font-black text-xl text-green-600 outline-none focus:ring-2 focus:ring-green-500 transition" 
                                                value={formData.meal_participants} onChange={e => setFormData({...formData, meal_participants: e.target.value})} />
                                        </div>
                                    </div>
                                    <button type="submit" disabled={loading} className="w-full bg-slate-900 text-white py-5 rounded-2xl font-black text-lg hover:bg-black transition-all shadow-xl flex items-center justify-center space-x-3 disabled:opacity-50">
                                        {loading ? <Icon name="refresh" className="animate-spin" /> : <Icon name="plus" />}
                                        <span>내역 저장 및 완료</span>
                                    </button>
                                </form>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
